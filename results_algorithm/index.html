



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Results Algorithm - RHTPT DOCUMENTATION</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#41-results-check-algorithm" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="RHTPT DOCUMENTATION" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              RHTPT DOCUMENTATION
            </span>
            <span class="md-header-nav__topic">
              
                Results Algorithm
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="RHTPT DOCUMENTATION" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    RHTPT DOCUMENTATION
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../design/" title="System Design and Analysis" class="md-nav__link">
      System Design and Analysis
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../systemdesign/" title="System Design" class="md-nav__link">
      System Design
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../stracture/" title="Code Stracture" class="md-nav__link">
      Code Stracture
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Results Algorithm
      </label>
    
    <a href="./" title="Results Algorithm" class="md-nav__link md-nav__link--active">
      Results Algorithm
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#41-results-check-algorithm" title="4.1 Results Check Algorithm" class="md-nav__link">
    4.1 Results Check Algorithm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-algorithm-functions" title="4.2 Algorithm Functions" class="md-nav__link">
    4.2 Algorithm Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-handle-function" title="4.2.1 Handle Function" class="md-nav__link">
    4.2.1 Handle Function
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#422-movedump-function" title="4.2.2 MoveDump Function" class="md-nav__link">
    4.2.2 MoveDump Function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-savetopt-function" title="4.3 SaveToPt Function" class="md-nav__link">
    4.3 SaveToPt Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-strip-is_a_date-dates-functions" title="4.4 Strip (), is_a_date(), dates () Functions" class="md-nav__link">
    4.4 Strip (), is_a_date(), dates () Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45-check-functions" title="4.5 Check Functions" class="md-nav__link">
    4.5 Check Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46-run-algorithm-function" title="4.6 Run Algorithm Function" class="md-nav__link">
    4.6 Run Algorithm Function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#41-results-check-algorithm" title="4.1 Results Check Algorithm" class="md-nav__link">
    4.1 Results Check Algorithm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-algorithm-functions" title="4.2 Algorithm Functions" class="md-nav__link">
    4.2 Algorithm Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-handle-function" title="4.2.1 Handle Function" class="md-nav__link">
    4.2.1 Handle Function
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#422-movedump-function" title="4.2.2 MoveDump Function" class="md-nav__link">
    4.2.2 MoveDump Function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-savetopt-function" title="4.3 SaveToPt Function" class="md-nav__link">
    4.3 SaveToPt Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-strip-is_a_date-dates-functions" title="4.4 Strip (), is_a_date(), dates () Functions" class="md-nav__link">
    4.4 Strip (), is_a_date(), dates () Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45-check-functions" title="4.5 Check Functions" class="md-nav__link">
    4.5 Check Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46-run-algorithm-function" title="4.6 Run Algorithm Function" class="md-nav__link">
    4.6 Run Algorithm Function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Results Algorithm</h1>
                
                <h3 id="41-results-check-algorithm">4.1 Results Check Algorithm</h3>
<p>The algorithm is the one responsible for counter checking the results entered by participants. The algorithm file is found in app/console/commands folder. The algorithm is a scheduled cron job which can be configured in the server to run as frequently as possible. The algorithm file includes all the necessary model for it to run.  It has a signature and a description that describe the console command.  A new command is instantiated using the construct function as shown below.</p>
<p><img alt="Import Algorithm" src="../image/import_algorithm.png" /></p>
<h2 id="42-algorithm-functions">4.2 Algorithm Functions</h2>
<h3 id="421-handle-function">4.2.1 Handle Function</h3>
<p>The handle function shown below fetches pending records form the dump database table then moves them to the pt table. This process involves calling another function moveDump. Then the data in the pt table is again checked to see if the panel_status column has the value of ‘checked’  which is one (1). Then every row which has that value is assigned to the variable $pts which is then passed to another called function runAlgorithm as a parameter for the background processing of the results to start.</p>
<p><img alt="Handle Function" src="../image/handle_function.png" /></p>
<h4 id="422-movedump-function">4.2.2 MoveDump Function</h4>
<p>This is the function which is called by the handle function to move data from the dump table to the pt table. The function uses the $dump parameter as the data retrieved from the dump table. Then a foreach loop is uses to loop through the rows. The if statement retrieves the participant full name column data so long as it is not empty. The participant name is used to find their id in the user’s table that is if they exist. If the user is not in the user table, a new user is created with role of a participant. This is shown below;</p>
<p><img alt="Check if new user is a tester function" src="../image/check_user_tester.png" /></p>
<p>The mfl code is then used to find the id of the facility otherwise the facility name is used to retrieve the facility code. The sub county id is also fetched and assigned to the sub_county_id column in the facility table. If the facility name is not found a new sub county instance is created and the name, county_id are data are added to the instance and saved. Once the saved the sub county id is retrieved from the instance and assigned to the facility sub_county_id  column then saved. The code is shown below;</p>
<p><img alt="Facility Save" src="../image/facility_save.png" /></p>
<p>The algorithm continues to get the program is based on the Title which is vct and assigned it to the variable $program_id.  Then a query is run to find if a user is registered in the registration table and if not, a new registration instance is created.  Otherwise a check of the user is done to check if the  given user id exist.</p>
<p><img alt="Reasons for non-performance logic" src="../image/reasons_non_performance.png" /></p>
<p>Then the user is enrolled to the available round where a check is done to see if the user has been already enrolled to a round otherwise a new <em>Enrol</em> instance is created and saved.</p>
<p><img alt="New PT instance save" src="../image/new_pt_instance_save.png" /></p>
<p>The new pt instance shown above is then uses to save all the data from the dump  database able via the saveToPt function. Part of saving process is shown below;</p>
<p><img alt="Test Kit Data Save" src="../image/test_kit_data_save.png" /></p>
<h3 id="43-savetopt-function">4.3 SaveToPt Function</h3>
<p>This function saves the data from the dump table to the pt table. The function accepts parameters for its functionalities to run.   First the field id is retrieved and if it has not been found, the field id is retrieved by the name and assigned to the $field_id variable.  Then a result query is run to check if the record exist in the results table and if not a new result instance is created. Otherwise the results object is used to save data to the pt_id and filed_id columns. Finally the data is saved. The logic is shown below;</p>
<p><img alt="Save to PT function" src="../image/save_to_pt_function.png" /></p>
<h3 id="44-strip-is_a_date-dates-functions">4.4 Strip (), is_a_date(), dates () Functions</h3>
<p>The strip function is responsible for removing the specified beginning of a text to get the Id alone, while the is_a_date function return the date format and finally the dates function is also responsible for the data format.</p>
<h3 id="45-check-functions">4.5 Check Functions</h3>
<p>This functions check whether the given parameters were correspond to the expected results once the results and test kits results are submitted by the user.
    • Check_dates (): This function checks when the testing panel kits were received by the participant. It also checks when the test panels were constituted and when they were used for testing.
    • Check_kit_info (): This functions checks that all the kit data provided is complete.
    • Check_expiry (): This function ensures that the kit used for testing was not expired.
    • Check_complete_results (): This functions ensures that all data to be captured by the results form was entered.
    • Check_correct_results (): This function checks the correctness of the results submitted.
    • Check_satisfaction (): This function uses the results from the check_corret_results  to determine whether the results is unsatisfactory.
    • Check_validity (): This function checks if the results submitted are valid.
    • Check_algorithm (): This function checks if the algorithm was followed during results entry.
    • Check_overall (): This function sets the overall result either satisfactory or unsatisfactory.</p>
<h3 id="46-run-algorithm-function">4.6 Run Algorithm Function</h3>
<p>This is the function which process the results once they have been submitted by a user. The function uses the data from the pt table as the parameter. Then a foreach loop is used to loop through the rows using the $pts variable returned from the handle function. Expected results for the round are fetched by retrieving the round id and the user. The user details are retrieved through the user’s registration id.</p>
<p>Then the lot panels are also retrieved and assigned to the $res variable.  The results from the $pt variables are then assigned to the $rs variable which is used to get all variables to be used after the loop. The different test kit variables columns are then filled identified by the id as shown below;</p>
<p><img alt="Get different variable function" src="../image/get_different_variable_function.png" /></p>
<p>After the kits and panels are checked the expected results are then fetched using the check function discussed above. After the results are checked agonists the expected results the pt table is updated with the below code and saved.</p>
<p><img alt="Verified results saved to PT table" src="../image/verified_results.png" /></p>
<p>Then a json response is returned indicating the algorithm has finished running.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../stracture/" title="Code Stracture" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Code Stracture
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>